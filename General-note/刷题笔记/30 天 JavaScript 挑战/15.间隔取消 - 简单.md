---
title: 15.间隔取消 - 简单
---
题目：
现给定一个函数 `fn`，一个参数数组 `args` 和一个时间间隔 `t`，返回一个取消函数 `cancelFn`。

在经过 `cancelTimeMs` 毫秒的延迟后，将调用返回的取消函数 `cancelFn`。

setTimeout(cancelFn, cancelTimeMs)

函数 `fn` 应立即使用参数 `args` 调用，然后每隔 `t` 毫秒调用一次，直到在 `cancelTimeMs` 毫秒时调用 `cancelFn`。

**示例 1：**

**输入：** `fn = (x) => x * 2, args = [4], t = 35, cancelT = 190`
**输出：**
```js
[
   {"time": 0, "returned": 8},
   {"time": 35, "returned": 8},
   {"time": 70, "returned": 8},
   {"time": 105, "returned": 8},
   {"time": 140, "returned": 8},
   {"time": 175, "returned": 8}
]
```
**解释：** 
```js
const cancelTimeMs = 190;
const cancelFn = cancellable((x) => x * 2, [4], 35);
setTimeout(cancelFn, cancelTimeMs);
```

每隔 35ms，调用 fn(4)。直到 t=190ms，然后取消。
第一次调用 fn 是在 0ms。fn(4) 返回 8。
第二次调用 fn 是在 35ms。fn(4) 返回 8。
第三次调用 fn 是在 70ms。fn(4) 返回 8。
第四次调用 fn 是在 105ms。fn(4) 返回 8。
第五次调用 fn 是在 140ms。fn(4) 返回 8。
第六次调用 fn 是在 175ms。fn(4) 返回 8。
在 t=190ms 时取消



### 间隔用例：
编辑应用中的自动保存： 在使用文本编辑器、文档处理器或其他内容创建工具时，经常需要有一个自动保存功能，以定期保存更改。你可以使用间隔取消来安排定期自动保存。如果用户明确保存文档或退出应用程序，你可以取消间隔以防止不必要的保存操作。

动画和幻灯片播放定时： 在开发过程中，你可能想要创建动画或幻灯片，以自动在不同状态或图像之间进行切换。你可以使用间隔取消来控制这些切换的时间。如果用户与动画或幻灯片进行交互，你可以取消间隔以暂停或停止自动切换。

注意： 对于更复杂或性能关键的动画，建议使用 `requestAnimationFrame` 方法，而不是 `setInterval`，因为它提供更好的性能和效率。

基于时间的提醒： 考虑一个任务管理应用程序，用户可以为特定任务设置提醒。你可以使用间隔取消来触发指定间隔的提醒。一旦用户确认了提醒或任务已完成，你可以取消间隔以停止后续的提醒。


### 面试提示
1. 在设置后是否可以动态更改间隔时间？

是的，可以通过使用 clearInterval 取消现有的间隔，然后使用更新后的时间使用 setInterval 设置新的间隔来动态更改间隔时间。这允许你根据不断变化的需求或用户交互动态调整定时。

注意： 虽然可以创建动态间隔的幻觉，但重要的是要注意，这不会真正动态更改原始的间隔时间。它取消了先前的间隔，并启动了一个新的间隔。

2. 使用间隔取消时是否需要考虑限制或性能问题？

当使用间隔取消时，重要的是考虑间隔时间以及对性能的潜在影响。频繁和短暂的间隔可能会占用大量 CPU 资源。此外，如果 fn 函数的执行时间长于间隔时间，那么后续的调用可能会重叠，导致意外行为。确保间隔时间和 fn 的执行时间得到适当的平衡是至关重要的。这就是为什么在某些情况下，强烈建议使用 requestAnimationFrame 这样的其他方法。

requestAnimationFrame 接受单个参数，即要执行的函数。当浏览器准备好重新绘制屏幕时，将调用指定的 requestAnimationFrame 函数。当此函数运行时，它取决于执行代码的计算机的 CPU 能力、浏览器打开的显示器的刷新率以及其他一些标准，以确保动画在占用尽可能少的资源的情况下尽可能流畅。

3. 如果间隔时间 (t) 设置为负值或零会发生什么？

它会立即连续执行，并将重复执行 0 或负数次，可能会阻塞主线程，导致浏览器不响应。

4. 可以在取消后重新启动或重新安排间隔吗？

尽管你无法直接重新启动已取消的间隔，但你可以通过使用所需的间隔时间和要执行的函数再次调用 setInterval 来创建一个新的间隔。



