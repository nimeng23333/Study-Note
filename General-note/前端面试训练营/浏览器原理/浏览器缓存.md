---
title: 浏览器缓存
---
重点：
1.对浏览器缓存机制的理解
2.协商缓存和强缓存的区别

# 对浏览器缓存机制的理解

第一次加载资源，服务器返回200，从服务器下载资源，并缓存文件与response header，供下次加载对比。
下一次加载，强制缓存优先级较高，先比较当前时间与上一次返回200时间差，没有超出cache-control设置的max-age则没有过期，命中强缓存，直接从本地读取，如果不支持HTML1.1，则从expires头判断
如果过期，表明强制缓存没有命中，开始协商缓存，向服务器发送If-none-match和If-modified-since请求。
服务器收到后根据Etag值判断被请求文件是否有修改，Etag一致就没有修改，命中协商缓存，返回304，不一致就有改动，返回新的资源文件带上新的Etag值返回200。
如果服务器收到的请求没有Etag，将从If-modified-since和被请求文件的最后修改时间做对比，一致则命中协商缓存，没命中就返回资源和新的last-modified和200。

很多网站资源加了版号，升级JS或CSS防止浏览器缓存，强制改版号，客户端会重新下载资源文件，保证获取网站更新。

# 协商缓存和强缓存的区别

1.强缓存
缓存资源有效则直接使用缓存资源，不会向服务器发送请求。

强缓存策略两种方式设置，http头信息中的Expires属性和cache-control属性。

expires是html1.0中的方式，1.1提出cache-control，提供更精确的缓存控制

2.协商缓存
如果没命中强制缓存
协商缓存条件：有Etag或Last-modified，并且请求头If-none-match或If-modified-since与服务器匹配，返回304

协商缓存会向服务器发送一个请求
会在请求头中添加一个 If-Modified-Since 的属性，属性值为上一次资源返回时的 Last-Modified 的值

[强制缓存：Expires，cache-control 和缓存协商：Last-modified ，Etag - HackerVirus - 博客园](https://www.cnblogs.com/Leo_wl/p/12890833.html)