---
title: 浏览器渲染原理
---
重点：
1.浏览器的渲染过程
2.浏览器的渲染优化

# 浏览器渲染过程

解析文档生成DOM树，DOM树的节点就是DOM对象
解析CSS文档生成CSSOM规则树
根据两个DOM树合成渲染树。渲染对象和DOM元素相对应，但不是一一对应，不可见DOM元素不会插入渲染树，一个DOM元素也可能对应多个渲染对象。渲染对象是一个包含颜色大小的矩形。
渲染对象插入渲染树的时候并没有大小和位置，当浏览器生成渲染树后会根据渲染树的位置进行布局，也叫回流。弄清楚在页面中具体位置和大小。也叫自动重排。
布局阶段结束后是绘制阶段，遍历渲染树并调用渲染对象的paint方法显示在屏幕上

# 浏览器的渲染优化

1.针对js：js会阻塞html和css解析，对加载方式改变进行优化
放在body最后
body中间不要写script标签
script标签引入有三种方式：1.直接引用2.async3.defer
两个异步加载外部js文件不会阻塞DOM解析

script：立刻停止页面渲染去加载资源文件，资源加载完后立刻执行js代码，js代码结束后继续渲染
async：下载完成后立刻异步加载，加载后立刻执行，多个async标签不保证加载顺序。
defer：下载完后立刻异步加载。加载后DOM树还没构建完成就等DOM树解析好再执行。多个defer标签按顺序执行。

2.针对CSS：link、@import、内联
link：浏览器派发一个新线程去加载资源，与此同时GUI渲染线程继续向下渲染
@import：GUI渲染线程暂停渲染，去服务器加载文件，资源文件没返回前不会继续渲染
style：GUI直接渲染

外部样式如果长时间没有加载完毕为了用户体验，会使用默认样式，确保首次渲染速度。所以CSS一般写在header中。
所以尽量使用link，而不是import。如果少用style

3.DOM树、CSSOM树
HTML文件代码层级不要太深
使用语义化标签
减少CSS代码的层级，浏览器是从右往左你想匹配机制，过深的选择器会显著增加渲染计算成本

4.减少回流与重绘
操作DOM尽量在低层级DOM节点
不适用table布局，小的改动会使整个table重新布局
使用CSS表达式
不要频繁操作元素样式，对于静态页面修改类名而不是修改样式
使用absolute或fixed脱离文档流，发生变化不影响其他元素
避免频繁操作DOM，创建文档片段documentFragment，在上面应用DOM操作再添加到文档里
将元素先设置为display:none，操作结束后再显示出来，因为none的元素上进行DOM操作不会引发回流和重绘
将DOM多个读操作或者写操作放在一起，而不是读写穿插。
得益于浏览器的渲染队列机制。
